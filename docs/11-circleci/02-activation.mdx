# Activation

The orb uses a Unity Editor instance to test and build your projects. These operations require
the instance to be activated before each job you run. 

Unity separates its licenses between `Personal` and `Professional`. The former applies to the
 _free_ and the latter to the _Pro_ and _Plus_ versions. Based on your use-case proceed to the 
 [Personal](#personal-license) or [Professional](#professional-license) license section.

## Personal license

Follow these steps if you are using Unity's _free_ version.

> _**Note:** Do NOT follow the steps for the personal license if you have a professional license._

#### Mental model

1. Use the Unity orb to create an activation file
2. Convert the activation file to a license file
3. Encoded the license file and save it in a CircleCI Context.

#### Creating an activation file

Add the workflow below to a [project set up in CircleCI](https://circleci.com/docs/getting-started):

```yaml
version: 2.1

orbs:
  unity: game-ci/unity@x.y.z

workflows:
   create-unity-activation-file:
      jobs:
         - unity/create-activation-file
```

If you require an activation file for a specific Unity version, provide the semantic version 
found on GameCI's [Docker images](https://game.ci/docs/docker/versions):

```yaml
version: 2.1

orbs:
  unity: game-ci/unity@x.y.z

workflows:
   create-unity-activation-file:
      jobs:
         - unity/create-activation-file:
               editor_version: 2022.1.11f1          
```

Commit and push the new workflow and navigate to your project in the CircleCI Dashboard. 
Identify the pipeline triggered by your changes and open the `unity/create-activation-file` job. 
In the `ARTIFACTS` tab, you will encounter the `Unity.alf` file. Download it and follow 
the next section steps

#### Converting the activation file

1. Navigate to [license.unity3d.com](https://license.unity3d.com/manual) and upload the
   `Unity.alf` file.
2. Answer the prompted questions.
2. Download the license file (Unity_v20XX.x.ulf). It's ok if the numbers don't match 
   your Unity version exactly.

#### Encoding and saving the license file in a Context

1. Encode the contents of your `Unity_v20XX.x.ulf` file to base64. If you have the `base64` 
   command line utility you can use:

   ```
   cat Unity_v20XX.x.ulf | base64
   ```

2. Go to `CircleCI` > `<Organizations Settings>` > `Contexts` > `Create Context` or 
   open an existing Context that you want to use.
3. Create the following secrets:
   - `UNITY_ENCODED_LICENSE` - _(Paste the content from **step 1**  here)_
   - `UNITY_USERNAME` - _(Add the email address that you use to log in to Unity)_
   - `UNITY_PASSWORD` - _(Add the password that you use to log in to Unity)_
4. Remove the `unity/create-activation-file` job from your `.circleci/config.yml`
   as it's no longer necessary.

**GameCI does not acquire nor store your Unity email or password. They are required for activating
the license during the build and test steps.**

> _**Note:** When changing Unity version, you may need to repeat the same process._

## Professional license

Follow these steps if you are using Unity's _Pro_ or _Plus_ version.

> _**Note:** Do NOT follow the steps for the professional license if you have a personal license._

1. Subscribe to Unity Pro or Unity Plus, and get your Serial Key from the
   [subscriptions page](https://id.unity.com/en/subscriptions).
2. Go to `CircleCI` > `<Organizations Settings>` > `Contexts` > `Create Context` or 
   open an existing Context that you want to use.
3. Create the following secrets:
   - `UNITY_SERIAL` - _(Paste the content from **step 1** here. It should look like this: 
     `XX-XXXX-XXXX-XXXX-XXXX-XXXX`)_
   - `UNITY_USERNAME` - _(Add the email address that you use to log in to Unity)_
   - `UNITY_PASSWORD` - _(Add the password that you use to log in to Unity)_

**GameCI does not acquire nor store your Unity email, password or serial. They are required for 
activating the license during the build and test steps.**


## Next steps

The license can now be used in test and build steps.

You are now ready to start configuring these.
